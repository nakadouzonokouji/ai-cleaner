<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†ç”»é¢ - AIæƒé™¤ã‚¬ã‚¤ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }

        .admin-header {
            background: #2c3e50;
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content h1 {
            font-size: 24px;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .nav-links a:hover {
            background: rgba(255,255,255,0.1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section h2 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .toolbar input, .toolbar select, .toolbar button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .toolbar input {
            flex: 1;
            min-width: 200px;
        }

        .toolbar button {
            background: #3498db;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toolbar button:hover {
            background: #2980b9;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #666;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .price {
            color: #e74c3c;
            font-weight: bold;
        }

        .rating {
            color: #f39c12;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .in-stock {
            background: #d4edda;
            color: #155724;
        }

        .out-stock {
            background: #f8d7da;
            color: #721c24;
        }

        .prime {
            background: #ff6b6b;
            color: white;
        }

        .actions {
            display: flex;
            gap: 5px;
        }

        .btn-edit, .btn-delete {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-edit {
            background: #3498db;
            color: white;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .feedback-chart {
            margin-top: 20px;
            height: 300px;
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            border: 1px solid #eee;
            padding: 20px;
            border-radius: 8px;
        }

        .chart-bar {
            width: 60px;
            background: linear-gradient(to top, #3498db, #2980b9);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: height 0.3s;
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            white-space: nowrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 20px;
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn-save, .btn-cancel {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-save {
            background: #27ae60;
            color: white;
        }

        .btn-cancel {
            background: #95a5a6;
            color: white;
        }

        /* ã‚³ãƒ¡ãƒ³ãƒˆè¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .comment-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .comment-item.good {
            border-left-color: #27ae60;
        }

        .comment-item.bad {
            border-left-color: #e74c3c;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .comment-method {
            font-weight: 600;
            color: #2c3e50;
        }

        .comment-date {
            font-size: 12px;
            color: #666;
        }

        .comment-text {
            color: #555;
            line-height: 1.5;
        }

        .comment-rating {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        .comment-rating.good {
            background: #d4edda;
            color: #155724;
        }

        .comment-rating.bad {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .toolbar {
                flex-direction: column;
            }

            .toolbar input {
                width: 100%;
            }

            .data-table {
                font-size: 12px;
            }

            .data-table th, .data-table td {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <div class="header-content">
            <h1>ğŸ› ï¸ ç®¡ç†ç”»é¢ - AIæƒé™¤ã‚¬ã‚¤ãƒ‰</h1>
            <nav class="nav-links">
                <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
                <a href="#products">å•†å“ç®¡ç†</a>
                <a href="#feedback">å•†å“ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</a>
                <a href="#method-feedback">æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</a>
                <a href="#export">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>ç·å•†å“æ•°</h3>
                <div class="number" id="totalProducts">0</div>
            </div>
            <div class="stat-card">
                <h3>åœ¨åº«ã‚ã‚Š</h3>
                <div class="number" id="inStockCount">0</div>
            </div>
            <div class="stat-card">
                <h3>Primeå¯¾è±¡</h3>
                <div class="number" id="primeCount">0</div>
            </div>
            <div class="stat-card">
                <h3>å¹³å‡è©•ä¾¡</h3>
                <div class="number" id="avgRating">0.0</div>
            </div>
        </div>

        <!-- å•†å“ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="section" id="products">
            <h2>å•†å“ç®¡ç†</h2>
            <div class="toolbar">
                <input type="text" placeholder="å•†å“ã‚’æ¤œç´¢..." id="searchInput">
                <select id="categoryFilter">
                    <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>
                    <option value="kitchen">ã‚­ãƒƒãƒãƒ³</option>
                    <option value="bathroom">ãƒã‚¹ãƒ«ãƒ¼ãƒ </option>
                    <option value="living">ãƒªãƒ“ãƒ³ã‚°</option>
                    <option value="floor">åºŠ</option>
                    <option value="toilet">ãƒˆã‚¤ãƒ¬</option>
                    <option value="window">çª“</option>
                </select>
                <select id="stockFilter">
                    <option value="">åœ¨åº«çŠ¶æ³</option>
                    <option value="inStock">åœ¨åº«ã‚ã‚Š</option>
                    <option value="outStock">åœ¨åº«ãªã—</option>
                </select>
                <button onclick="addProduct()">+ æ–°è¦å•†å“è¿½åŠ </button>
                <button onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
            </div>
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>å•†å“ID</th>
                            <th>å•†å“å</th>
                            <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
                            <th>ä¾¡æ ¼</th>
                            <th>è©•ä¾¡</th>
                            <th>ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°</th>
                            <th>åœ¨åº«</th>
                            <th>Prime</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        <!-- å•†å“ãƒ‡ãƒ¼ã‚¿ã¯å‹•çš„ã«ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="section" id="feedback">
            <h2>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ†æ</h2>
            <div class="feedback-chart" id="feedbackChart">
                <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒãƒ£ãƒ¼ãƒˆã¯å‹•çš„ã«ç”Ÿæˆ -->
            </div>
            <div style="margin-top: 20px;">
                <h3>ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è©³ç´°</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>å•†å“å</th>
                            <th>Good ğŸ‘</th>
                            <th>Bad ğŸ‘</th>
                            <th>è©•ä¾¡ç‡</th>
                        </tr>
                    </thead>
                    <tbody id="feedbackTableBody">
                        <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã¯å‹•çš„ã«ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="section" id="method-feedback">
            <h2>æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</h2>
            
            <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <h3>ç·ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ•°</h3>
                    <div class="number" id="totalMethodFeedback">0</div>
                </div>
                <div class="stat-card">
                    <h3>Goodè©•ä¾¡</h3>
                    <div class="number" id="goodMethodCount" style="color: #27ae60;">0</div>
                </div>
                <div class="stat-card">
                    <h3>Badè©•ä¾¡</h3>
                    <div class="number" id="badMethodCount" style="color: #e74c3c;">0</div>
                </div>
                <div class="stat-card">
                    <h3>æº€è¶³åº¦</h3>
                    <div class="number" id="methodSatisfactionRate">0%</div>
                </div>
            </div>

            <!-- æƒé™¤æ–¹æ³•åˆ¥ãƒãƒ£ãƒ¼ãƒˆ -->
            <div style="margin-bottom: 30px;">
                <h3>æƒé™¤æ–¹æ³•åˆ¥è©•ä¾¡ãƒãƒ£ãƒ¼ãƒˆ</h3>
                <div class="feedback-chart" id="methodFeedbackChart" style="height: 400px;">
                    <!-- ãƒãƒ£ãƒ¼ãƒˆã¯å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ« -->
            <div style="margin-bottom: 30px;">
                <h3>æƒé™¤æ–¹æ³•åˆ¥ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è©³ç´°</h3>
                <div class="toolbar">
                    <input type="text" placeholder="æƒé™¤æ–¹æ³•ã‚’æ¤œç´¢..." id="methodSearchInput">
                    <select id="methodCategoryFilter">
                        <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒªãƒ¼</option>
                        <option value="kitchen">ã‚­ãƒƒãƒãƒ³</option>
                        <option value="bathroom">ãƒã‚¹ãƒ«ãƒ¼ãƒ </option>
                        <option value="living">ãƒªãƒ“ãƒ³ã‚°</option>
                        <option value="floor">åºŠ</option>
                        <option value="toilet">ãƒˆã‚¤ãƒ¬</option>
                        <option value="window">çª“</option>
                    </select>
                    <button onclick="exportMethodData()">æ–¹æ³•ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>æƒé™¤æ–¹æ³•</th>
                                <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
                                <th>Good ğŸ‘</th>
                                <th>Bad ğŸ‘</th>
                                <th>æº€è¶³åº¦</th>
                                <th>ã‚³ãƒ¡ãƒ³ãƒˆæ•°</th>
                                <th>æœ€æ–°ã‚³ãƒ¡ãƒ³ãƒˆ</th>
                            </tr>
                        </thead>
                        <tbody id="methodFeedbackTableBody">
                            <!-- ãƒ‡ãƒ¼ã‚¿ã¯å‹•çš„ã«ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div>
                <h3>æœ€æ–°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
                <div class="toolbar">
                    <select id="commentFilter">
                        <option value="">ã™ã¹ã¦ã®ã‚³ãƒ¡ãƒ³ãƒˆ</option>
                        <option value="good">Goodè©•ä¾¡ã®ã¿</option>
                        <option value="bad">Badè©•ä¾¡ã®ã¿</option>
                    </select>
                    <button onclick="refreshComments()">æ›´æ–°</button>
                </div>
                <div id="methodCommentsList" style="max-height: 400px; overflow-y: auto; margin-top: 10px;">
                    <!-- ã‚³ãƒ¡ãƒ³ãƒˆã¯å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </section>
    </div>

    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>å•†å“ç·¨é›†</h3>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <form id="editForm">
                <div class="form-group">
                    <label>å•†å“ID (ASIN)</label>
                    <input type="text" id="editId" readonly>
                </div>
                <div class="form-group">
                    <label>å•†å“å</label>
                    <input type="text" id="editName" required>
                </div>
                <div class="form-group">
                    <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                    <select id="editCategory" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="kitchen">ã‚­ãƒƒãƒãƒ³</option>
                        <option value="bathroom">ãƒã‚¹ãƒ«ãƒ¼ãƒ </option>
                        <option value="living">ãƒªãƒ“ãƒ³ã‚°</option>
                        <option value="floor">åºŠ</option>
                        <option value="toilet">ãƒˆã‚¤ãƒ¬</option>
                        <option value="window">çª“</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ä¾¡æ ¼ (å††)</label>
                    <input type="number" id="editPrice" required>
                </div>
                <div class="form-group">
                    <label>è©•ä¾¡ (1-5)</label>
                    <input type="number" id="editRating" min="1" max="5" step="0.1" required>
                </div>
                <div class="form-group">
                    <label>ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°</label>
                    <input type="number" id="editReviews" required>
                </div>
                <div class="form-group">
                    <label>èª¬æ˜</label>
                    <textarea id="editDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editInStock"> åœ¨åº«ã‚ã‚Š
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="editPrime"> Primeå¯¾è±¡
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn-save">ä¿å­˜</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // å•†å“ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        let productsData = [];
        let feedbackData = {};

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        function loadProducts() {
            // å®Ÿéš›ã®products-master.jsonã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            fetch('products-master.json')
                .then(response => response.json())
                .then(data => {
                    productsData = data.products;
                    updateStats();
                    renderProductTable();
                    loadFeedback();
                })
                .catch(() => {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
                    const stored = localStorage.getItem('productsData');
                    if (stored) {
                        productsData = JSON.parse(stored);
                        updateStats();
                        renderProductTable();
                        loadFeedback();
                    }
                });
        }

        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        function loadFeedback() {
            const stored = localStorage.getItem('productFeedback');
            if (stored) {
                feedbackData = JSON.parse(stored);
                renderFeedbackChart();
                renderFeedbackTable();
            }
        }

        // çµ±è¨ˆæƒ…å ±ã®æ›´æ–°
        function updateStats() {
            document.getElementById('totalProducts').textContent = productsData.length;
            document.getElementById('inStockCount').textContent = productsData.filter(p => p.inStock).length;
            document.getElementById('primeCount').textContent = productsData.filter(p => p.prime).length;
            
            const avgRating = productsData.reduce((sum, p) => sum + p.rating, 0) / productsData.length;
            document.getElementById('avgRating').textContent = avgRating.toFixed(1);
        }

        // å•†å“ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderProductTable() {
            const tbody = document.getElementById('productTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const stockFilter = document.getElementById('stockFilter').value;

            const filtered = productsData.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                    product.id.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || product.category.startsWith(categoryFilter);
                const matchesStock = !stockFilter || 
                                   (stockFilter === 'inStock' && product.inStock) ||
                                   (stockFilter === 'outStock' && !product.inStock);
                return matchesSearch && matchesCategory && matchesStock;
            });

            tbody.innerHTML = filtered.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td class="price">Â¥${product.price.toLocaleString()}</td>
                    <td class="rating">â˜…${product.rating}</td>
                    <td>${product.reviews.toLocaleString()}</td>
                    <td><span class="status-badge ${product.inStock ? 'in-stock' : 'out-stock'}">
                        ${product.inStock ? 'åœ¨åº«ã‚ã‚Š' : 'åœ¨åº«ãªã—'}
                    </span></td>
                    <td>${product.prime ? '<span class="status-badge prime">Prime</span>' : '-'}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="editProduct('${product.id}')">ç·¨é›†</button>
                        <button class="btn-delete" onclick="deleteProduct('${product.id}')">å‰Šé™¤</button>
                    </td>
                </tr>
            `).join('');
        }

        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒãƒ£ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderFeedbackChart() {
            const chart = document.getElementById('feedbackChart');
            const topProducts = Object.entries(feedbackData)
                .map(([id, data]) => {
                    const product = productsData.find(p => p.id === id);
                    return {
                        id,
                        name: product ? product.name : 'Unknown',
                        total: (data.good || 0) + (data.bad || 0),
                        goodRate: (data.good || 0) / ((data.good || 0) + (data.bad || 0))
                    };
                })
                .sort((a, b) => b.total - a.total)
                .slice(0, 10);

            const maxTotal = Math.max(...topProducts.map(p => p.total), 1);

            chart.innerHTML = topProducts.map(product => `
                <div class="chart-bar" style="height: ${(product.total / maxTotal) * 250}px">
                    <div class="chart-label">${product.name.substring(0, 10)}...</div>
                </div>
            `).join('');
        }

        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderFeedbackTable() {
            const tbody = document.getElementById('feedbackTableBody');
            const feedbackArray = Object.entries(feedbackData)
                .map(([id, data]) => {
                    const product = productsData.find(p => p.id === id);
                    const good = data.good || 0;
                    const bad = data.bad || 0;
                    const total = good + bad;
                    return {
                        name: product ? product.name : 'Unknown',
                        good,
                        bad,
                        rate: total > 0 ? (good / total * 100).toFixed(1) : '-'
                    };
                })
                .filter(item => item.good > 0 || item.bad > 0)
                .sort((a, b) => (b.good + b.bad) - (a.good + a.bad));

            tbody.innerHTML = feedbackArray.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.good}</td>
                    <td>${item.bad}</td>
                    <td>${item.rate}%</td>
                </tr>
            `).join('');
        }

        // å•†å“ç·¨é›†
        function editProduct(id) {
            const product = productsData.find(p => p.id === id);
            if (!product) return;

            document.getElementById('editId').value = product.id;
            document.getElementById('editName').value = product.name;
            document.getElementById('editCategory').value = product.category.split('-')[0];
            document.getElementById('editPrice').value = product.price;
            document.getElementById('editRating').value = product.rating;
            document.getElementById('editReviews').value = product.reviews;
            document.getElementById('editDescription').value = product.description || '';
            document.getElementById('editInStock').checked = product.inStock;
            document.getElementById('editPrime').checked = product.prime;

            document.getElementById('editModal').style.display = 'flex';
        }

        // å•†å“å‰Šé™¤
        function deleteProduct(id) {
            if (confirm('ã“ã®å•†å“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                productsData = productsData.filter(p => p.id !== id);
                saveProducts();
                updateStats();
                renderProductTable();
            }
        }

        // æ–°è¦å•†å“è¿½åŠ 
        function addProduct() {
            // æ–°è¦å•†å“ç”¨ã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('editId').value = 'B0' + Math.random().toString(36).substr(2, 8).toUpperCase();
            document.getElementById('editName').value = '';
            document.getElementById('editCategory').value = '';
            document.getElementById('editPrice').value = '';
            document.getElementById('editRating').value = '4.0';
            document.getElementById('editReviews').value = '0';
            document.getElementById('editDescription').value = '';
            document.getElementById('editInStock').checked = true;
            document.getElementById('editPrime').checked = false;

            document.getElementById('editModal').style.display = 'flex';
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('editId').value;
            const updatedProduct = {
                id: id,
                name: document.getElementById('editName').value,
                category: document.getElementById('editCategory').value,
                price: parseInt(document.getElementById('editPrice').value),
                rating: parseFloat(document.getElementById('editRating').value),
                reviews: parseInt(document.getElementById('editReviews').value),
                description: document.getElementById('editDescription').value,
                inStock: document.getElementById('editInStock').checked,
                prime: document.getElementById('editPrime').checked,
                image: 'https://m.media-amazon.com/images/I/71placeholder._AC_SL1500_.jpg',
                url: `https://www.amazon.co.jp/dp/${id}`
            };

            const existingIndex = productsData.findIndex(p => p.id === id);
            if (existingIndex !== -1) {
                productsData[existingIndex] = { ...productsData[existingIndex], ...updatedProduct };
            } else {
                productsData.push(updatedProduct);
            }

            saveProducts();
            updateStats();
            renderProductTable();
            closeModal();
        });

        // å•†å“ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveProducts() {
            localStorage.setItem('productsData', JSON.stringify(productsData));
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportData() {
            const dataStr = JSON.stringify({ products: productsData, feedback: feedbackData }, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `ai-cleaner-data-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½
        document.getElementById('searchInput').addEventListener('input', renderProductTable);
        document.getElementById('categoryFilter').addEventListener('change', renderProductTable);
        document.getElementById('stockFilter').addEventListener('change', renderProductTable);

        // åˆæœŸåŒ–
        loadProducts();

        // ===== æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é–¢é€£ã®é–¢æ•° =====
        let methodFeedbackData = {};
        let methodCommentsData = [];

        // æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        function loadMethodFeedback() {
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
            const storedFeedback = localStorage.getItem('methodFeedback');
            const storedComments = localStorage.getItem('methodComments');
            
            if (storedFeedback) {
                methodFeedbackData = JSON.parse(storedFeedback);
            }
            
            if (storedComments) {
                methodCommentsData = JSON.parse(storedComments);
            }

            // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆï¼‰
            if (Object.keys(methodFeedbackData).length === 0) {
                generateDemoMethodData();
            }

            updateMethodStats();
            renderMethodFeedbackChart();
            renderMethodFeedbackTable();
            renderMethodComments();
        }

        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ
        function generateDemoMethodData() {
            const methods = [
                { id: 'kitchen-sink-light', name: 'ã‚­ãƒƒãƒãƒ³ã‚·ãƒ³ã‚¯ï¼ˆè»½ã„æ±šã‚Œï¼‰', category: 'kitchen' },
                { id: 'kitchen-sink-heavy', name: 'ã‚­ãƒƒãƒãƒ³ã‚·ãƒ³ã‚¯ï¼ˆé ‘å›ºãªæ±šã‚Œï¼‰', category: 'kitchen' },
                { id: 'bathroom-bathtub-light', name: 'æµ´æ§½ï¼ˆè»½ã„æ±šã‚Œï¼‰', category: 'bathroom' },
                { id: 'bathroom-bathtub-heavy', name: 'æµ´æ§½ï¼ˆé ‘å›ºãªæ±šã‚Œï¼‰', category: 'bathroom' },
                { id: 'toilet-floor-light', name: 'ãƒˆã‚¤ãƒ¬åºŠï¼ˆè»½ã„æ±šã‚Œï¼‰', category: 'toilet' },
                { id: 'living-carpet-light', name: 'ã‚«ãƒ¼ãƒšãƒƒãƒˆï¼ˆè»½ã„æ±šã‚Œï¼‰', category: 'living' },
                { id: 'window-glass-light', name: 'çª“ã‚¬ãƒ©ã‚¹ï¼ˆè»½ã„æ±šã‚Œï¼‰', category: 'window' },
                { id: 'floor-tile-heavy', name: 'ã‚¿ã‚¤ãƒ«åºŠï¼ˆé ‘å›ºãªæ±šã‚Œï¼‰', category: 'floor' }
            ];

            methods.forEach(method => {
                const good = Math.floor(Math.random() * 50) + 10;
                const bad = Math.floor(Math.random() * 10) + 1;
                methodFeedbackData[method.id] = {
                    name: method.name,
                    category: method.category,
                    good: good,
                    bad: bad,
                    comments: []
                };
            });

            // ãƒ‡ãƒ¢ã‚³ãƒ¡ãƒ³ãƒˆã®ç”Ÿæˆ
            const demoComments = [
                { methodId: 'kitchen-sink-light', rating: 'good', text: 'ã¨ã¦ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„æ‰‹é †ã§ã—ãŸã€‚10åˆ†ã§ç¶ºéº—ã«ãªã‚Šã¾ã—ãŸï¼', date: new Date().toISOString() },
                { methodId: 'kitchen-sink-heavy', rating: 'good', text: 'é‡æ›¹ã¨ã‚¯ã‚¨ãƒ³é…¸ã®çµ„ã¿åˆã‚ã›ãŒåŠ¹æœçš„ã§ã—ãŸã€‚', date: new Date().toISOString() },
                { methodId: 'bathroom-bathtub-light', rating: 'bad', text: 'æ€ã£ãŸã‚ˆã‚Šæ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚', date: new Date(Date.now() - 86400000).toISOString() },
                { methodId: 'toilet-floor-light', rating: 'good', text: 'å®‰å…¨å¯¾ç­–ã®èª¬æ˜ãŒä¸å¯§ã§åŠ©ã‹ã‚Šã¾ã—ãŸã€‚', date: new Date(Date.now() - 172800000).toISOString() }
            ];

            methodCommentsData = demoComments;
            saveMethodData();
        }

        // æƒé™¤æ–¹æ³•çµ±è¨ˆã®æ›´æ–°
        function updateMethodStats() {
            let totalGood = 0;
            let totalBad = 0;

            Object.values(methodFeedbackData).forEach(data => {
                totalGood += data.good || 0;
                totalBad += data.bad || 0;
            });

            const total = totalGood + totalBad;
            const satisfactionRate = total > 0 ? (totalGood / total * 100).toFixed(1) : 0;

            document.getElementById('totalMethodFeedback').textContent = total;
            document.getElementById('goodMethodCount').textContent = totalGood;
            document.getElementById('badMethodCount').textContent = totalBad;
            document.getElementById('methodSatisfactionRate').textContent = satisfactionRate + '%';
        }

        // æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒãƒ£ãƒ¼ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderMethodFeedbackChart() {
            const chart = document.getElementById('methodFeedbackChart');
            const methodArray = Object.entries(methodFeedbackData)
                .map(([id, data]) => ({
                    id,
                    name: data.name,
                    good: data.good || 0,
                    bad: data.bad || 0,
                    total: (data.good || 0) + (data.bad || 0)
                }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 8);

            const maxTotal = Math.max(...methodArray.map(m => m.total), 1);

            chart.innerHTML = methodArray.map(method => {
                const goodHeight = (method.good / maxTotal) * 350;
                const badHeight = (method.bad / maxTotal) * 350;
                return `
                    <div style="display: flex; flex-direction: column; align-items: center; width: 80px;">
                        <div style="display: flex; align-items: flex-end; height: 350px;">
                            <div style="width: 30px; background: #27ae60; height: ${goodHeight}px; margin-right: 2px; border-radius: 4px 4px 0 0;"></div>
                            <div style="width: 30px; background: #e74c3c; height: ${badHeight}px; border-radius: 4px 4px 0 0;"></div>
                        </div>
                        <div class="chart-label" style="text-align: center; margin-top: 10px; font-size: 11px;">
                            ${method.name.length > 10 ? method.name.substring(0, 10) + '...' : method.name}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderMethodFeedbackTable() {
            const tbody = document.getElementById('methodFeedbackTableBody');
            const searchTerm = document.getElementById('methodSearchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('methodCategoryFilter').value;

            const filtered = Object.entries(methodFeedbackData)
                .filter(([id, data]) => {
                    const matchesSearch = data.name.toLowerCase().includes(searchTerm);
                    const matchesCategory = !categoryFilter || data.category === categoryFilter;
                    return matchesSearch && matchesCategory;
                })
                .map(([id, data]) => {
                    const good = data.good || 0;
                    const bad = data.bad || 0;
                    const total = good + bad;
                    const satisfaction = total > 0 ? (good / total * 100).toFixed(1) : '-';
                    const comments = methodCommentsData.filter(c => c.methodId === id);
                    const latestComment = comments.length > 0 ? comments[0].text.substring(0, 30) + '...' : '-';

                    return {
                        name: data.name,
                        category: data.category,
                        good,
                        bad,
                        satisfaction,
                        commentCount: comments.length,
                        latestComment
                    };
                });

            tbody.innerHTML = filtered.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.category}</td>
                    <td style="color: #27ae60; font-weight: bold;">${item.good}</td>
                    <td style="color: #e74c3c; font-weight: bold;">${item.bad}</td>
                    <td>${item.satisfaction}%</td>
                    <td>${item.commentCount}</td>
                    <td>${item.latestComment}</td>
                </tr>
            `).join('');
        }

        // ã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderMethodComments() {
            const container = document.getElementById('methodCommentsList');
            const filter = document.getElementById('commentFilter').value;

            const filtered = methodCommentsData
                .filter(comment => !filter || comment.rating === filter)
                .sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filtered.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            container.innerHTML = filtered.map(comment => {
                const method = methodFeedbackData[comment.methodId];
                const date = new Date(comment.date).toLocaleDateString('ja-JP');
                return `
                    <div class="comment-item ${comment.rating}">
                        <div class="comment-header">
                            <div>
                                <span class="comment-method">${method ? method.name : 'Unknown'}</span>
                                <span class="comment-rating ${comment.rating}">${comment.rating === 'good' ? 'Good ğŸ‘' : 'Bad ğŸ‘'}</span>
                            </div>
                            <span class="comment-date">${date}</span>
                        </div>
                        <div class="comment-text">${comment.text}</div>
                    </div>
                `;
            }).join('');
        }

        // æƒé™¤æ–¹æ³•ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveMethodData() {
            localStorage.setItem('methodFeedback', JSON.stringify(methodFeedbackData));
            localStorage.setItem('methodComments', JSON.stringify(methodCommentsData));
        }

        // æƒé™¤æ–¹æ³•ãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportMethodData() {
            const exportData = {
                feedback: methodFeedbackData,
                comments: methodCommentsData,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `method-feedback-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // ã‚³ãƒ¡ãƒ³ãƒˆã®æ›´æ–°
        function refreshComments() {
            renderMethodComments();
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ 
        document.getElementById('methodSearchInput').addEventListener('input', renderMethodFeedbackTable);
        document.getElementById('methodCategoryFilter').addEventListener('change', renderMethodFeedbackTable);
        document.getElementById('commentFilter').addEventListener('change', renderMethodComments);

        // æƒé™¤æ–¹æ³•ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã‚‚èª­ã¿è¾¼ã‚€
        setTimeout(loadMethodFeedback, 100);
    </script>
</body>
</html>