<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæƒé™¤ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ - ç®¡ç†ç”»é¢</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN warning in production
        if (typeof tailwind !== 'undefined') {
            tailwind.config = {
                // Add any custom configuration here
            }
        }
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="bg-gray-800 text-white">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-2xl font-bold">ğŸ”§ AIæƒé™¤ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ ç®¡ç†ç”»é¢</h1>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="container mx-auto px-6 py-8">
        <!-- çµ±è¨ˆã‚µãƒãƒªãƒ¼ -->
        <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-sm text-gray-500 mb-2">ç·ç›¸è«‡æ•°</h3>
                <p class="text-3xl font-bold text-blue-600" id="totalQueries">0</p>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-sm text-gray-500 mb-2">ä»Šæ—¥ã®ç›¸è«‡æ•°</h3>
                <p class="text-3xl font-bold text-green-600" id="todayQueries">0</p>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-sm text-gray-500 mb-2">æœ€ã‚‚å¤šã„å ´æ‰€</h3>
                <p class="text-2xl font-bold text-purple-600" id="topLocation">-</p>
            </div>
            <div class="bg-white rounded-lg shadow p-6">
                <h3 class="text-sm text-gray-500 mb-2">å¹³å‡å¿œç­”æ™‚é–“</h3>
                <p class="text-3xl font-bold text-orange-600">2.3ç§’</p>
            </div>
        </section>

        <!-- ã‚°ãƒ©ãƒ•ã‚¨ãƒªã‚¢ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- ã‚ˆãã‚ã‚‹è³ªå• -->
            <section class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ“Š ã‚ˆãã‚ã‚‹è³ªå•TOP10</h2>
                <div id="popularQueries" class="space-y-2">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </section>

            <!-- äººæ°—ã®æƒé™¤ç®‡æ‰€ -->
            <section class="bg-white rounded-lg shadow p-6">
                <h2 class="text-xl font-bold mb-4">ğŸ  äººæ°—ã®æƒé™¤ç®‡æ‰€</h2>
                <canvas id="locationChart" width="400" height="300"></canvas>
            </section>
        </div>

        <!-- æ™‚é–“å¸¯åˆ¥ã‚¢ã‚¯ã‚»ã‚¹ -->
        <section class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-bold mb-4">â° æ™‚é–“å¸¯åˆ¥åˆ©ç”¨çŠ¶æ³</h2>
            <canvas id="timeChart" width="400" height="200"></canvas>
        </section>

        <!-- æœ€è¿‘ã®ç›¸è«‡å±¥æ­´ -->
        <section class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">ğŸ“ æœ€è¿‘ã®ç›¸è«‡å±¥æ­´</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ™‚åˆ»</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è³ªå•å†…å®¹</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ãƒ‡ãƒã‚¤ã‚¹</th>
                        </tr>
                    </thead>
                    <tbody id="recentQueries" class="bg-white divide-y divide-gray-200">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒœã‚¿ãƒ³ -->
        <section class="mt-8 text-center">
            <button onclick="exportData()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg">
                ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (CSV)
            </button>
        </section>
    </main>

    <script>
        // ç®¡ç†ç”»é¢ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
        let stats = null;

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«çµ±è¨ˆã‚’è¡¨ç¤º
        window.addEventListener('DOMContentLoaded', () => {
            loadStats();
            setInterval(loadStats, 30000); // 30ç§’ã”ã¨ã«æ›´æ–°
        });

        function loadStats() {
            // dialogue-app.jsã‹ã‚‰çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            if (window.dialogueAdvisor) {
                stats = window.dialogueAdvisor.getAnalysisStats();
                updateDashboard();
            } else {
                // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
                stats = getMockStats();
                updateDashboard();
            }
        }

        function getMockStats() {
            return {
                totalQueries: 1234,
                popularQueries: [
                    { query: 'ã‚­ãƒƒãƒãƒ³ã‚’æƒé™¤ã—ãŸã„', count: 156 },
                    { query: 'æ›æ°—æ‰‡ã®æ²¹æ±šã‚Œ', count: 142 },
                    { query: 'æµ´å®¤ã®ã‚«ãƒ“', count: 98 },
                    { query: 'ãƒˆã‚¤ãƒ¬ã®æƒé™¤', count: 87 },
                    { query: 'ã‚·ãƒ³ã‚¯ã®æ°´å¢', count: 76 }
                ],
                popularLocations: [
                    { location: 'ã‚­ãƒƒãƒãƒ³', count: 456 },
                    { location: 'æµ´å®¤', count: 234 },
                    { location: 'ãƒˆã‚¤ãƒ¬', count: 198 },
                    { location: 'çª“', count: 123 },
                    { location: 'åºŠ', count: 89 }
                ],
                timeDistribution: [
                    5, 3, 2, 1, 1, 4, 12, 34, 45, 56, 67, 78,
                    89, 76, 65, 54, 67, 89, 98, 87, 65, 43, 21, 10
                ]
            };
        }

        function updateDashboard() {
            // çµ±è¨ˆã‚µãƒãƒªãƒ¼æ›´æ–°
            document.getElementById('totalQueries').textContent = stats.totalQueries;
            document.getElementById('todayQueries').textContent = getTodayCount();
            document.getElementById('topLocation').textContent = stats.popularLocations[0]?.location || '-';

            // ã‚ˆãã‚ã‚‹è³ªå•æ›´æ–°
            updatePopularQueries();

            // ã‚°ãƒ©ãƒ•æ›´æ–°
            updateLocationChart();
            updateTimeChart();

            // æœ€è¿‘ã®å±¥æ­´æ›´æ–°
            updateRecentQueries();
        }

        function getTodayCount() {
            // ä»Šæ—¥ã®ç›¸è«‡æ•°ã‚’è¨ˆç®—ï¼ˆå®Ÿè£…ç°¡ç•¥åŒ–ï¼‰
            return Math.floor(stats.totalQueries * 0.1);
        }

        function updatePopularQueries() {
            const container = document.getElementById('popularQueries');
            container.innerHTML = stats.popularQueries
                .slice(0, 10)
                .map((item, index) => `
                    <div class="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
                        <span class="text-gray-700">${index + 1}. ${item.query}</span>
                        <span class="text-gray-500 text-sm">${item.count}ä»¶</span>
                    </div>
                `).join('');
        }

        function updateLocationChart() {
            const ctx = document.getElementById('locationChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: stats.popularLocations.map(l => l.location),
                    datasets: [{
                        data: stats.popularLocations.map(l => l.count),
                        backgroundColor: [
                            '#3B82F6',
                            '#10B981',
                            '#F59E0B',
                            '#EF4444',
                            '#8B5CF6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateTimeChart() {
            const ctx = document.getElementById('timeChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => `${i}æ™‚`),
                    datasets: [{
                        label: 'åˆ©ç”¨æ•°',
                        data: stats.timeDistribution,
                        borderColor: '#3B82F6',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateRecentQueries() {
            const tbody = document.getElementById('recentQueries');
            const recentLogs = [
                { time: '10:23', query: 'ã‚­ãƒƒãƒãƒ³ã®æ›æ°—æ‰‡ã‚’æƒé™¤ã—ãŸã„', device: 'iPhone' },
                { time: '10:15', query: 'æµ´å®¤ã®ã‚«ãƒ“ã‚’å–ã‚ŠãŸã„', device: 'Android' },
                { time: '09:58', query: 'ã‚·ãƒ³ã‚¯ã®æ°´å¢ãŒå–ã‚Œãªã„', device: 'PC' },
                { time: '09:45', query: 'ãƒˆã‚¤ãƒ¬ã®é»„ã°ã¿ã‚’è½ã¨ã—ãŸã„', device: 'iPad' },
                { time: '09:32', query: 'ãƒ•ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã®æƒé™¤æ–¹æ³•', device: 'Android' }
            ];

            tbody.innerHTML = recentLogs.map(log => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${log.time}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${log.query}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${log.device}</td>
                </tr>
            `).join('');
        }

        function exportData() {
            // CSVå½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            let csv = 'ã‚¿ã‚¤ãƒ—,å†…å®¹,ä»¶æ•°\n';
            
            csv += '\nã‚ˆãã‚ã‚‹è³ªå•\n';
            stats.popularQueries.forEach(q => {
                csv += `è³ªå•,"${q.query}",${q.count}\n`;
            });
            
            csv += '\näººæ°—ã®æƒé™¤ç®‡æ‰€\n';
            stats.popularLocations.forEach(l => {
                csv += `å ´æ‰€,${l.location},${l.count}\n`;
            });

            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `cleaning_advisor_stats_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }
    </script>

    <script src="dialogue-app.js"></script>
</body>
</html>